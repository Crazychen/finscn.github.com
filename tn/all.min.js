"use strict";(function(){var h,j,m=0,k;function g(b,d,a,n){if(arguments.length===3){n=a;a=d;d=document;}var e=function(o){var o=o||window.event;n.call(b,o);
};d.addEventListener(a,e,false);}function l(b){var d={};for(var a in b){d[a]=b[a];}return d;}function i(a){a=l(a);var b;if(a.type=="mousedown"||a.type=="touchstart"){b="Down";
}else{if(a.type=="mouseup"||a.type=="touchend"){b="Up";}else{b="Click";}}a.hw={x:a.PJ-k.x+document.body.scrollLeft+document.documentElement.scrollLeft,y:a.KZ-k.y+document.body.scrollTop+document.documentElement.scrollTop};
f.rl(b,a);}function c(a){a=l(a);f.rl(a.type,a);}var f={m:{k:[],U:[],input:[]},qa:function(){this.x7=this.i;this.N3=0;this.T5=this.i;this.iT=1000/this.i;
this.e1=Date.now();},LU:function(){this.x7--;var a=Date.now();this.iT=this.iT*0.85+(a-this.e1)*0.15;this.e1=a;if(this.x7==0){this.x7=this.i;this.N3=this.T5;
this.T5=(10000/this.iT>>0)/10;}},extend:function(b){for(var a in b){if(!b.hasOwnProperty(a)){continue;}this[a]=b[a];}},J:function(a,b){this.canvas=a;this.S$=a.getContext("2d");
this.width=a.width;this.height=a.height;k=f.W2.fZ(a);if(b){b(a);}},start:function(){var a=this;j=Date.now();h=setInterval(function(){a.step();},1000/f.i);
this.qa();},step:function(){var a=Date.now();var b=a-j;j=a;f.pI(b,m++);f.LU();f.Cn(this.S$);},stop:function(){},pI:function(n,b){var e=this.m.k,d=0,a=e.length;
for(;d<a;++d){e[d](n,b);}},k:function(a){this.m.k.push(a);},Cn:function(d){var a=this.m.U,e=0,b=a.length;for(;e<b;++e){a[e](d);}},U:function(a){this.m.U.push(a);
},rl:function(n,b){var e=this.m.input,d=0,a=e.length;for(;d<a;++d){e[d](n,b);}},input:function(a){this.m.input.push(a);}};f.extend({W2:{fZ:function(e){if(!e.getBoundingClientRect){return{x:0,y:0};
}var b=e.getBoundingClientRect(),o=b.left+(window.pageXOffset?window.pageXOffset:document.body.scrollTop),n=b.top+(window.pageYOffset?window.pageYOffset:document.body.scrollLeft),a=parseInt(this.O(e,"border-left-width")||0,10)||parseInt(this.O(e,"borderLeftWidth")||0,10)||0,d=parseInt(this.O(e,"border-top-width")||0,10)||parseInt(this.O(e,"borderTopWidth")||0,10)||0;
o+=a;n+=d;return{x:o,y:n};},O:function(b,d){var a;if(b.Qz){a=b.Qz[this.dx(d)];}else{if(window.getComputedStyle){a=document.defaultView.getComputedStyle(b,null).getPropertyValue(this.My(d));
}}return a;},dx:function(a){return a.replace(/-+(.)?/g,function(b,d){return d?d.toUpperCase():"";});},My:function(a){return a.replace(/[A-Z]/g,function(b){return b?"-"+b.toLowerCase():"";
});}}});window.ih=f;}());(function(){var s=window.ih;var F=function(E){for(var J in E){this[J]=E[J];}};F.prototype={x:0,y:0,d:0,scale:1,Y:0,d1:0,A:0,I:0,j:0,F:0,K:1,o:0,n:1,f:0,T:1,W:0,YS:false,fy:false,g:false,B6:null,J:function(C){this.B6=C;
this.IF={x:this.x,y:this.y,d:this.d,I:this.I,j:this.j,F:this.F};this.Q={x:0,y:0,d:1};this.H=this.H||[];this.r=this.H.length;var D=this;this.H.forEach(function(P){P.parent=D;
P.scale=1;P.N=true;P.x+=D.x;P.y+=D.y;P.d+=D.d;P.Y=P.x;P.d1=P.y;P.A=P.d;});this.g=true;C.Hw(this.H);},setPosition:function($,A,y){this.x=$;this.y=A;this.d=y;
this.cx();},cx:function(){this.g=true;},translate:function(e,P,X){this.x+=e;this.y+=P;this.d+=X;for(var C=0;C<this.r;C++){var j=this.H[C];j.x+=e;j.y+=P;
j.d+=X;}this.cx();},Vn:function(A){if(!A){return;}this.g=true;this.I+=A;var m=Math.cos(A);var c=Math.sin(A);var x=this.Q;var e=x.y*m-x.d*c;var P=x.y*c+x.d*m;
x.y=e;x.d=P;for(var U=0;U<this.r;U++){x=this.H[U];var D=x.y-this.y;var g=x.d-this.d;e=D*m-g*c;P=D*c+g*m;x.y=e+this.y;x.d=P+this.d;}},Lp:function(e){if(!e){return;
}this.g=true;this.j+=e;var m=Math.cos(e);var J=Math.sin(e);var d=this.Q;Z=d.d*m-d.x*J;D=d.d*J+d.x*m;d.d=Z;d.x=D;for(var c=0;c<this.r;c++){d=this.H[c];var M=d.d-this.d;
var P=d.x-this.x;var Z=M*m-P*J;var D=M*J+P*m;d.d=Z+this.d;d.x=D+this.x;}},y5:function(A){if(!A){return;}this.g=true;this.F+=A;var U=Math.cos(A);var g=Math.sin(A);
var P=this.Q;var j=P.x*U-P.y*g;var t=P.x*g+P.y*U;P.x=j;P.y=t;for(var B=0;B<this.r;B++){P=this.H[B];var c=P.x-this.x;var d=P.y-this.y;j=c*U-d*g;t=c*g+d*U;
P.x=j+this.x;P.y=t+this.y;}},t:function(D){},NW:function(P,E){},U:function(r){}};var b=function(g){for(var $ in g){this[$]=g[$];}this.J();};b.prototype={x:0,y:0,d:0,I:0,j:0,F:0,K:1,o:0,n:1,f:0,T:1,W:0,Zq:600,width:400,height:400,YS:false,fy:false,g:false,B6:null,J:function(y){this.B6=y;
this.IF={x:this.x,y:this.y,d:this.d,I:this.I,j:this.j,F:this.F};this.g=true;},translate:function(v,$,A){this.x+=v;this.y+=$;this.d+=A;this.g=true;},Vn:function(M){if(!M){return;
}this.g=true;this.I+=M;this.K=Math.cos(this.I);this.o=Math.sin(this.I);},Lp:function(P){if(!P){return;}this.g=true;this.j+=P;this.n=Math.cos(this.j);this.f=Math.sin(this.j);
},y5:function(q){if(!q){return;}this.g=true;this.F+=q;this.T=Math.cos(this.F);this.W=Math.sin(this.F);},Mw:function(x){var t=x.x-this.x;var y=x.y-this.y;
var U=x.d-this.d;if(this.I){var c=this.K*y+this.o*U;var D=this.K*U-this.o*y;y=c;U=D;}if(this.j){var $=this.n*t-this.f*U;var D=this.n*U+this.f*t;t=$;U=D;
}if(this.F){var $=this.W*y+this.T*t;var c=this.T*y-this.W*t;t=$;y=c;}x.N=U<0;if(x.N){var X=-this.Zq/U;x.scale=X;x.Y=t*X;x.d1=y*X;x.A=U;}return x;},Oj:function(J){J.sort(function(v,M){return v.A-M.A;
});}};var H=function(X){for(var m in X){this[m]=X[m];}};H.prototype={origin:null,p:null,entities:null,J:function(){this.origin={x:0,y:0,d:0};this.u=this.u||{x:0,y:0,d:0};
this.p=this.p||new Camera({x:0,y:0,d:0,Zq:600});this.entities=this.entities||[];this.H=this.H||[];},LO:function(k){k.J(this);this.entities.push(k);},Hw:function(J){var v=this;
if(Array.isArray(J)){J.forEach(function(U){v.H.push(U);});}else{v.H.push(J);}},t:function(t){var _=this.p;this.entities.forEach(function(d){d.t(t);});this.H.forEach(function(E){var j=E.parent;
if(_.g||j.g){_.Mw(E);}});this.entities.forEach(function($){$.g=false;});_.g=false;},U:function(r){this.p.Oj(this.H);r.save();r.translate(this.u.x,this.u.y);
this.entities.forEach(function(U){U.U(r);});this.H.forEach(function(y){var t=y.parent;t.NW(y,r);});r.restore();}};function n(U){for(var v in U){this[v]=U[v];
}}n.prototype=new F();n.prototype.t=function(m){if(this.B){this.H.forEach(function(_){_.y+=m*m*_.oK/2;});this.g=true;}};n.prototype.NW=function(q,_){if(!q.N){return;
}var U=40*q.scale,x=40*q.scale;var D=q.w*q.scale,r=q.h*q.scale;var X=q.alpha;q.alpha+=q.sG;if(q.alpha>=1){q.sG=-Math.abs(q.sG);}else{if(q.alpha<=0.3){q.sG=Math.abs(q.sG);
}}_.globalAlpha=q.alpha;if(this.B){}_.drawImage(s.Wa._,q.mP,q.vL,q.zA,q.tr,q.Y+this.XN-D/2,q.d1+this.kc-r/2,D,r);};n.prototype.U=function(M){var m=0;var _=this.Q;
var x=_.x*_.x+_.y*_.y+(_.d-1)*(_.d-1);var P=0.25;if(x<P){m=(P-x)/P;this.P=-0.001;if(x<P/3){this.P/=2;}}else{this.P=-0.002;}if(this.B){return;}M.beginPath();
M.globalAlpha=m;M.SQ=1.6;M.strokeStyle="rgba(255,255,255,0.5)";for(var A=0;A<Q.I3.length;A++){var X=Q.I3[A];M.moveTo(X[0].Y+this.XN,X[0].d1+this.kc);for(var d=1;
d<X.length;d++){M.lineTo(X[d].Y+this.XN,X[d].d1+this.kc);}}M.stroke();M.closePath();};var Q=[];function o(){var D=[{x:128,y:106,v:[[128,106],[240,90]]},{x:186,y:103,v:[[186,103],[176,218]]},{x:234,y:139,v:[[222,139],[246,212],[265,139],[292,211],[314,146]]},{x:353,y:127,v:[[353,127],[342,212]]},{x:398,y:188,v:[[382,214],[393,132],[432,213],[442,125]]},{x:483,y:129,v:[[483,129],[474,215]]},{x:510,y:145,v:[[519,130],[480,174],[519,211]]},{x:544,y:97,v:[[545,121],[539,213],[574,213]]},{x:595,y:162,v:[[593,165],[642,163]]},{x:626,y:114,v:[[633,126],[592,133],[591,209],[640,208]]}];
var $=[];var _=[];var Z=0;var c=-Infinity,E=-Infinity;var B=Infinity,t=Infinity;D.forEach(function(x){var v=[];_.push(v);x.v.forEach(function(k){var q={x:k[0]*0.4,y:k[1]*0.4};
if(q.x<B){B=q.x;}if(q.y<t){t=q.y;}if(q.x>c){c=q.x;}if(q.y>E){E=q.y;}$.push(q);v.push(q);Z++;});});var g=c-B,y=E-t;$.forEach(function(j){var d=j;var J=(j.x-B-g/2)*1.1,C=j.y-t-y/2;
var V=s.p.Zq;var k=s.c(-10,10)*50;var m=-V/(-1000+k-s.p.d);var M=J/m;var X=C/m;d.d=k;d.mP=0;d.vL=0;d.zA=32;d.tr=32;d.x=M*2;d.y=X*2;d.oK=s.c(1,2)/1000;d.sG=0.02*[-1,1][s.c(0,1)];
d.alpha=s.c(5,10)/10;d.w=d.zA*s.c(8,12)/10;d.h=d.tr*s.c(8,12)/10;d.scale=m;Q.push(d);});Q.I3=_;s.R=new n({H:Q,x:0,y:0,d:-1000,XN:-75,kc:-120,P:-0.001});
}var K=K||{width:660,height:440,i:55};function l(v,X){return(X-v+1)*Math.random()+v>>0;}var i=new b({d:900,Zq:800});var a=new H({u:{x:K.width/2,y:K.height/2,d:0},p:i});
var O=new Image();O.src="res/tree.png";var Y=new Image();Y.src="res/big-star.png";var L=new Image();L.src="res/star.png";var W=new Image();W.src="res/star2.png";
var p=new Image();p.src="res/sky.png";p.onload=function(){};function T(m){return document.getElementById(m);}var u;function h(){s.Pw=true;s.p=i;s.c=l;u=document.getElementById("canvas");
u.width=K.width;u.height=K.height;s.i=K.i;s.J(u,function(){s.S$.font="20pt Heiti SC";a.J();o();a.LO(s.R);s.R.Vn(0.9);});var D;var C=false;s.k(function($,V){D=window.eval;
if(!C&&S.currentTime>=57){C=true;N.style.opacity=1;G.style.height=440+"px";}if(S.currentTime>40){s.R.B=true;}if(!s.R.B){s.R.Vn(s.R.P);}a.t($);R.t($);});
s.U(function(c){if(s.R.B){}s.S$.drawImage(p,0,0);c.globalAlpha=1;a.U(c);R.U(c);c.drawImage(O,0,440-O.height);});s.input(function(_,E){if(_=="Up"){var j=E.hw;
}});s.start();}var R={_:Y,x:660,y:-205,Zz:0.00008,o2:8e-8,S:0,r0:true,t:function(k){if(this.r0){this.r0=false;this.S=0;this.e=this.Zz;this.D=-this.o2;}var g=this.S;
var m=this.e;this.e=this.e+this.D*k;this.S=this.S+(this.e+m)*k/2;if(g<0&&this.S>=0){this.S=0;this.e=this.Zz;this.D=-this.o2;}else{if(g>0&&this.S<=0){this.S=0;
this.e=-this.Zz;this.D=this.o2;}else{if(this.S==0){}}}},U:function(c){c.save();this.x=660-this._.width/2-10;c.translate(this.x,this.y);c.rotate(this.S);
c.drawImage(this._,-this._.width/2,200);c.restore();}};var z={width:4,height:4,_:L,_Q:W};var S=new Audio();function f(){if(s.Pw){return;}w.style.opacity=0;
setTimeout(function(){N.style.opacity=0;S.play();h();},1000);}var G,N;var w,I;window.onload=function(){N=T("mask");G=T("words");w=T("info");I=T("loading");
S.preload="auto";S.za=true;S.loop=true;S.src="./res/bgm.mp3";S.load();S.addEventListener("canplaythrough",function(D){I.style.opacity=0;w.style.opacity=1;
window.addEventListener("click",function(){f();});window.addEventListener("keyup",function(){f();});},false);};s.Wa=z;s.vR=S;}());